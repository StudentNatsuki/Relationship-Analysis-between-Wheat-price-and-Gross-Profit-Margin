{
 "cells": [
  {
   "cell_type": "markdown",
   "id": "a4a45cf7-084f-4531-befc-068393af604f",
   "metadata": {},
   "source": [
    "# Panel Regression Analysis of Gross Profit Margins in Japan's Bakery and Restaurant Industries\n",
    "\n",
    "## 1. Overview\n",
    "\n",
    "### Purpose\n",
    "\n",
    "* In Japan, wheat is centrally imported and resold to food manufacturers at a fixed government price (official government selling price).\n",
    "* Due to non-tariff barriers (import quotas), this price effectively determines the wheat input cost for companies.\n",
    "* This project analyzes how government pricing policy affects corporate gross profit margins using firm-level panel data, with attention to inter-industry differences.\n",
    "* **Null Hypothesis 1**: Government wheat prices have no effect on gross profit margins in bakery and restaurant firms.\n",
    "* **Null Hypothesis 2**: The effect of government wheat prices on gross profit margins is the same across industries.\n",
    "* We aim to statistically test and potentially reject these hypotheses.\n",
    "\n",
    "### Target Firms\n",
    "\n",
    "* Firms with quarterly financial statements from two industries:\n",
    "\n",
    "  * **Bakery**: Yamazaki Baking Co., Ltd., Daiichiya Seipan, Nisshin Seifun Group Inc.\n",
    "  * **Restaurant**: Gyoza no Ohsho, Toridoll Holdings Corporation, Skylark Holdings Co., Ltd.\n",
    "\n",
    "### Period\n",
    "\n",
    "* 2015 Q1 to 2025 Q4\n",
    "\n",
    "---\n",
    "\n",
    "## 2. Project Structure\n",
    "* `README_en.md`: short overview document (English)\n",
    "* `README_full_en.md`: This overview document (English)\n",
    "* `code.ipynb`: Main analysis notebook (fully reproducible by running sequential cells)\n",
    "* `panel_data.xlsx`: Input dataset\n",
    "* `output/`: Output folder containing visualizations and summary files\n",
    "\n",
    "---\n",
    "\n",
    "## 3. Data Sources\n",
    "\n",
    "* **Gross Profit Margins**: IRBANK, financial reports from each company\n",
    "* **Consumer Price Index (CPI)**: Statistics Bureau of Japan (specifically \"Bread\" and \"Restaurant\" CPI series)\n",
    "* **Government Wheat Prices**: Ministry of Agriculture, Forestry and Fisheries (MAFF), official announcement documents\n",
    "\n",
    "---\n",
    "\n",
    "## 4. Analysis Workflow\n",
    "\n",
    "1. Data preprocessing (quarterly encoding, lag variable creation, PCA, spline basis functions)\n",
    "2. Fixed effects panel regression\n",
    "   (with **Driscoll-Kraay robust covariance estimation** and interaction terms)\n",
    "3. Residual diagnostics (plots, ACF, VIF)\n",
    "4. Model results and figure exports\n",
    "\n",
    "---\n",
    "\n",
    "## 5. How to Run\n",
    "\n",
    "* Required libraries: `pandas`, `numpy`, `statsmodels`, `linearmodels`, `joblib`, `matplotlib`, `seaborn`\n",
    "* Run `code.ipynb` using Jupyter Notebook\n",
    "* Make sure `panel_data.xlsx` is placed in the same directory\n",
    "\n",
    "---\n",
    "\n",
    "## 6. Key Findings\n",
    "\n",
    "* Wheat prices have a **statistically significant impact** on gross profit margins in both bakery and restaurant sectors (rejecting Null Hypothesis 1)\n",
    "* The degree of sensitivity varies by industry (rejecting Null Hypothesis 2)\n",
    "* Spline terms on AR(1) and AR(4) components help capture non-linearities\n",
    "* Residuals generally satisfy assumptions of normality and independence\n",
    "* Internal corporate factors may have stronger influence than external pricing factors\n",
    "\n",
    "---\n",
    "\n",
    "## 7. Limitations\n",
    "\n",
    "* Sample size is limited to 6 firms\n",
    "* Lag settings and variable selection were based on exploratory testing\n",
    "\n",
    "---\n",
    "\n",
    "## 8. Output Folder Contents\n",
    "\n",
    "* 0. Load and preprocess data\n",
    "\n",
    "  * `output_processed_panel_data.xlsx`\n",
    "  * `output_panel_data_coverage_heatmap.png`\n",
    "\n",
    "* 1. Visualize Data Structure\n",
    "\n",
    "  * `output_Gross_Profit_Margin_by_company_timeseries.png`\n",
    "  * `output_Government_Sale_Price_by_company_timeseries.png`\n",
    "  * `output_CPI_by_company_timeseries.png`\n",
    "\n",
    "* 2. Multicollinearity\n",
    "\n",
    "  * `output_VIF_results.csv`\n",
    "\n",
    "* 3. Identify Optimal Lags\n",
    "\n",
    "  * `output_lag_combination_R2_list.csv`\n",
    "  * `output_lag_combination_R2_heatmap.png`\n",
    "\n",
    "* 4. Main Model\n",
    "\n",
    "  * `industry_MAE_R2_df3.png`\n",
    "  * `industry_metrics.csv`\n",
    "  * `model_summaries.pkl`\n",
    "  * `Bakery_summary.txt`\n",
    "  * `Bakery_residuals_vs_GovPrice_lag4_1000_LOWESS.png`\n",
    "  * `Bakery_residuals_vs_fitted_LOWESS.png`\n",
    "  * `Bakery_residuals_vs_CPI_lag0_LOWESS.png`\n",
    "  * `Bakery_residual_histogram.png`\n",
    "  * `Bakery_residual_ACF.png`\n",
    "  * `Restaurant_summary.txt`\n",
    "  * `Restaurant_residuals_vs_GovPrice_lag4_1000_LOWESS.png`\n",
    "  * `Restaurant_residuals_vs_fitted_LOWESS.png`\n",
    "  * `Restaurant_residuals_vs_CPI_lag0_LOWESS.png`\n",
    "  * `Restaurant_residual_histogram.png`\n",
    "  * `Restaurant_residual_ACF.png`\n",
    "\n",
    "* 5. Coefficient Trends by Lag\n",
    "\n",
    "  * `output_gov_price_lag_coeff_trend.png`\n",
    "  * `output_cpi_lag_coeff_trend.png`\n",
    "\n",
    "* 6. Interaction Term Model\n",
    "\n",
    "  * `interaction_model_summary.txt`\n",
    "  * `interaction_model_residuals_vs_Interaction_GovPrice_by_industry.png`\n",
    "  * `interaction_model_residuals_vs_GovPrice_centered_by_industry.png`\n",
    "  * `interaction_model_residuals_vs_CPI_lag0_by_industry.png`\n",
    "  * `interaction_model_residual_histogram.png`\n",
    "  * `interaction_model_residual_ACF.png`\n",
    "  * `interaction_model_metrics_comparison.png`\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "d3fc421b-07f6-4132-8a19-fbff6680f2a7",
   "metadata": {},
   "outputs": [],
   "source": []
  }
 ],
 "metadata": {
  "kernelspec": {
   "display_name": "anaconda-panel-2023.05-py310",
   "language": "python",
   "name": "conda-env-anaconda-panel-2023.05-py310-py"
  },
  "language_info": {
   "codemirror_mode": {
    "name": "ipython",
    "version": 3
   },
   "file_extension": ".py",
   "mimetype": "text/x-python",
   "name": "python",
   "nbconvert_exporter": "python",
   "pygments_lexer": "ipython3",
   "version": "3.11.5"
  }
 },
 "nbformat": 4,
 "nbformat_minor": 5
}
