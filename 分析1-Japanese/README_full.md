# 製パン・外食業売上総利益率パネル回帰分析

## 1. 概要

### 1. 目的

- 小麦は日本政府が一括で輸入し、企業に政府売渡価格で販売している  
- 小麦は非関税障壁（輸入割当）があり、企業にとってはこの政府売渡価格が実質的な仕入れ価格の起点となる  
- 国家政策として、それが企業の売上総利益率にどの程度影響を与えているのか、業種により差があるかを企業パネルデータで分析  
- **帰無仮説1**：小麦の政府売渡価格は、製パン・外食企業の売上総利益率に影響を与えない  
- **帰無仮説2**：小麦の政府売渡価格は、製パン・外食企業の売上総利益率に異なる影響を与えない  
- この2つの帰無仮説を棄却するかを統計的に検証する

### 2. 対象企業

- 四半期の決算短信を公表している企業から製パン・外食を各3社選定  
- **製パン**：山崎製パン、第一屋製パン、日清製粉グループ  
- **外食**：王将フードサービス、トリドールホールディングス、すかいらーくホールディングス

### 3. 対象期間

- 2015年Q1〜2025年Q4

---

## 2. 構成ファイル

- `README.md`：簡潔な概要
- `README_full.md`：このファイル（詳細版）
- `コード.ipynb`：分析本体（セルを順に実行するだけで再現可能）
- `パネルデータ.xlsx`：入力データ
- `結果/`：図表やサマリファイル一式

---

## 3. データソース

- **売上総利益率**：IRBANK、および各企業の決算短信
- **CPI**：総務省統計局「パン」「外食」関連CPI
- **政府売渡価格**：農林水産省「輸入小麦の政府売渡価格の改定について」
- **主要変数**：`企業名`, `売上総利益率`, `政府売渡価格`, `CPI`, `四半期_numeric` など

---

## 4. 分析の流れ

1. データ前処理（四半期番号付与、ラグ変数、PCA、スプライン変換）
2. 固定効果パネル回帰（Driscoll-Kraayによる誤差推定＋交差項）
3. 残差診断（ACF、VIF、分布チェック）
4. 結果出力（グラフ・指標保存）

---

## 5. 実行方法

- 必要ライブラリ：`pandas`, `numpy`, `statsmodels`, `linearmodels`, `joblib`, `matplotlib`, `seaborn`
- `コード.ipynb` をJupyterで実行
- `パネルデータ.xlsx` は同階層に置く必要あり
- 出力は `結果/` フォルダに保存される

---

## 6. 結果のポイント

- 製パン・外食ともに政府売渡価格と売上総利益率の間に**統計的に有意な関係**（帰無仮説1を棄却）
- 感応度に業種間で差がある（帰無仮説2も棄却）
- 自己項（AR(1), AR(4)）にスプライン項を入れることで非線形性を補足
- 残差はおおむね正規性・独立性を満たし、自己相関も少なく、モデル健全性は高い
- ただし、売上総利益率は外的要因よりも**企業内部要因の影響が強い可能性**

---

## 7. 制約事項

- サンプル数が6社と少ない
- ラグや変数の選定は事前検証による

---

## 8. `結果/` フォルダ構成

### 0. データ読み込みと前処理
- 出力_パネルデータ構造ヒートマップ.png  
- 出力_加工済みパネルデータ.xlsx  

### 1. データ構造の可視化
- 出力_企業別_CPI_折れ線推移.png  
- 出力_企業別_政府売渡価格_折れ線推移.png  
- 出力_企業別_売上総利益率_折れ線推移.png  

### 2. 多重共線性のチェック
- 出力_VIF結果.csv  

### 3. 最適なラグの確認
- 出力_ラグ組み合わせ_R2_ヒートマップ.png  
- 出力_ラグ組み合わせ_R2一覧.csv  

### 4. メインモデル
- model_summaries.pkl  
- 製パン_summary.txt、外食_summary.txt  
- 各残差プロット（ヒストグラム・ACF・LOWESS）  
- 業種別_MAE_R2_df3.png  
- 業種別_metrics.csv  

### 5. ラグに伴う係数の推移
- 出力_CPIラグ_係数推移.png  
- 出力_政府売渡価格ラグ_係数推移.png  

### 6. 交差項を入れたメインモデル
- 共通モデル_summary.txt  
- 共通モデル_残差ヒストグラム.png  
- 共通モデル_残差ACF.png  
- 残差 vs CPI / 政府価格 / 交差項 の業種別可視化  
- 共通モデル_指標比較.png
